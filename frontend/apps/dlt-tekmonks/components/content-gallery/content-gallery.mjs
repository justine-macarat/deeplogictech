import{i18n}from"/framework/js/i18n.mjs";import{util}from"/framework/js/util.mjs";import{router}from"/framework/js/router.mjs";import{session}from"/framework/js/session.mjs";import{monkshu_component}from"/framework/js/monkshu_component.mjs";async function elementConnected(t){let e;t.getAttribute("styleBody")&&(e=`<style>${t.getAttribute("styleBody")}</style>`);let n=`<style>.cell{width: ${100/t.getAttribute("tiles_per_row")}%;}</style>`,o=await createPageData(t);o.styleBody=e,o.styleCellWidth=n,t.id?(content_gallery.datas||(content_gallery.datas={}),content_gallery.datas[t.id]=o):content_gallery.data=o}async function createPageData(t){const e=t.getAttribute("path"),n=await(await fetch(`${APP_CONSTANTS.API_CMS_DIR_CONTENTS}?q=${e}`)).json();if(!n.result)return{};let o={};const{content_post:s}=await import(`${APP_CONSTANTS.APP_PATH}/components/content-post/content-post.mjs`);for(const t of n.files)/main\..+/.test(t)&&(o.main={content:await s.getArticle(`${e}/${t}`),link:router.encodeURL(`./article.html?article_path=${e}/${t}`)});const r=n.files.filter((t=>-1==t.indexOf(".")));if(o.subcontent=[],0==r.length){const n=-1!=e.indexOf("/")?e.substring(e.lastIndexOf("/")+1):e;o.subcontent.push({heading:{content:await getMassagedEntryName(n),link:router.encodeURL(session.get($$.MONKSHU_CONSTANTS.PAGE_URL))},rows:await getSubBlogs(e,t.getAttribute("tiles_per_row"))})}else for(const n of r)o.subcontent.push({heading:{content:await getMassagedEntryName(n),link:router.encodeURL(util.replaceURLParamValue(session.get($$.MONKSHU_CONSTANTS.PAGE_URL),t.getAttribute("path_name"),`${e}/${n}`))},rows:[(await getSubBlogs(`${t.getAttribute("path")}/${n}`,t.getAttribute("tiles_per_row")))[0]]});return o}async function getSubBlogs(t,e){const n=await(await fetch(`${APP_CONSTANTS.API_CMS_DIR_CONTENTS}?q=${t}`)).json();if(!n.result)return[];const o=n.files.filter((t=>-1!=t.indexOf(".")));let s=0,r=[],a=[];const{content_post:i}=await import(`${APP_CONSTANTS.APP_PATH}/components/content-post/content-post.mjs`);for(const n of o){const o=`${t}/${n}`;r.push({content:await i.getArticle(o),id:"notblank",link:router.encodeURL(`./article.html?article_path=${o}`)}),s++,s==e&&(a.push(r),r=[])}if(r.length){const t=e-r.length;for(let e=0;e<t;e++)r.push({id:"blank"});a.push(r)}return a}async function getMassagedEntryName(t){const e=await i18n.getI18NObject(session.get($$.MONKSHU_CONSTANTS.LANG_ID));return e[t]?t=e[t]:(t.length&&(t=t.substring(0,1).toUpperCase()+t.substring(1)),-1!=t.indexOf(".")&&(t=t.substring(0,t.indexOf(".")))),t}function register(){monkshu_component.register("content-gallery",`${APP_CONSTANTS.APP_PATH}/components/content-gallery/content-gallery.html`,content_gallery)}const trueWebComponentMode=!0;export const content_gallery={trueWebComponentMode:true,register:register,elementConnected:elementConnected};