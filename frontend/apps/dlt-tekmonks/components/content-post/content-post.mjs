import{monkshu_component}from"/framework/js/monkshu_component.mjs";import{router}from"/framework/js/router.mjs";import{session}from"/framework/js/session.mjs";async function elementConnected(t){const e=t.getAttribute("article");if(!e)return;const n=await getArticle(e);let r,o,s;t.getAttribute("styleContainer")&&(r=`style="${t.getAttribute("styleContainer")}"`),t.getAttribute("styleArticle")&&(o=`<style>${t.getAttribute("styleArticle")}</style>`),t.getAttribute("styleBody")&&(s=`<style>${t.getAttribute("styleBody")}</style>`),t.id?(content_post.datas||(content_post.datas={}),content_post.datas[t.id]={article:n,styleBody:s,style:r,styleArticle:o}):content_post.data={article:n,styleBody:s,style:r,styleArticle:o}}async function getArticle(t){let e=t+`/${getArticlei18nName(t.substring(t.lastIndexOf("/")+1))}`;try{return renderArticle(e,await(await fetch(`${APP_CONSTANTS.CMS_ROOT_URL}/${e}`)).text())}catch(e){return LOG.error(`Error reading article ${t}: ${e}`),""}}async function renderArticle(t,e){await $$.require(`${APP_CONSTANTS.APP_PATH}/components/content-post/3p/showdown.min.js`),await $$.require(`${APP_CONSTANTS.APP_PATH}/components/content-post/3p/showdown.extension.targetlink.min.js`);let n=e;(null==t||t.toLowerCase().endsWith(".md"))&&(n=new showdown.Converter({parseImgDimensions:!0,simplifiedAutoLink:!0,tables:!0,simpleLineBreaks:!0,emoji:!0,underline:!0,extensions:["targetlink"]}).makeHtml(e)),await $$.require("/framework/3p/mustache.min.js"),Mustache.parse(n);let r=getContentFunctions();return n=Mustache.render(n,r),n}function getContentFunctions(){return{makeLink:t=>(t,e)=>router.encodeURL(e(t))}}function getArticlei18nName(t){return t.substring(0,t.lastIndexOf(".")+1)+session.get($$.MONKSHU_CONSTANTS.LANG_ID)+t.substring(t.lastIndexOf("."))}function register(){monkshu_component.register("content-post",`${APP_CONSTANTS.APP_PATH}/components/content-post/content-post.html`,content_post)}const trueWebComponentMode=!0;export const content_post={trueWebComponentMode:true,register:register,elementConnected:elementConnected,getArticle:getArticle,renderArticle:renderArticle};