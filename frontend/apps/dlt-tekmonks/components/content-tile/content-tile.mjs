import{util}from"/framework/js/util.mjs";import{monkshu_component}from"/framework/js/monkshu_component.mjs";async function elementConnected(t){let e;t.getAttribute("styleBody")&&(e=`<style>${t.getAttribute("styleBody")}</style>`),t.id?(content_tile.datas||(content_tile.datas={}),content_tile.datas[t.id]={styleBody:e}):content_tile.data={styleBody:e}}async function elementRendered(t){let e=t.getAttribute("path"),l=await(await fetch(`${APP_CONSTANTS.API_CMS_DIR_CONTENTS}?q=${e}&type=text`)).json();if(!l.result)return;let o=t.shadowRoot.querySelector("div#container");t.getAttribute("style")&&(o.style.cssText=t.getAttribute("style"));let s=l.files;for(const[t,l]of s.entries())s[t]=`${e}/${l}`;let i=t.getAttribute("tiles_per_slide")||4,n=s.length%i!=0?1+~~(s.length/i):s.length/i;styleDots(t,n),styleSliderArrows(t,n),await setArticles(t,s,n,i),runAnimation(t,n,t.getAttribute("pause")||5e3)}function styleDots(t,e){if(1!=e){if(t.getAttribute("dot_style")){let e=util.getCSSRule(t.shadowRoot,".nav-dots .nav-dot").style.cssText;util.getCSSRule(t.shadowRoot,".nav-dots .nav-dot").style.cssText=e+t.getAttribute("dot_style")}if(t.getAttribute("selected_dot_style")){let e=util.getCSSRule(t.shadowRoot,".nav-dots .nav-dot:hover").style.cssText;util.getCSSRule(t.shadowRoot,".nav-dots .nav-dot:hover").style.cssText=e+t.getAttribute("selected_dot_style"),util.getCSSRule(t.shadowRoot,".nav-dot-selected").style.cssText=e+t.getAttribute("selected_dot_style")+" !important"}}else t.shadowRoot.querySelector("div#slider .nav-dots").style.visibility="hidden"}async function setArticles(t,e,l,o){let s=t.shadowRoot.querySelector("div#slider figure");s.style.width=100*l+"%";for(let i of e){let e=document.createElement("article");const{content_post:n}=await import(`${APP_CONSTANTS.APP_PATH}/components/content-post/content-post.mjs`);e.innerHTML=await n.getArticle(i),t.getAttribute("article_style")&&(e.style=t.getAttribute("article_style"));let r=`calc(${100/l/o}% - ${e.style.paddingLeft} - ${e.style.paddingRight})`;e.style.width=r,s.appendChild(e)}let i=t.shadowRoot.querySelector("div#slider li");for(let e=0;e<l;e++){let o=document.createElement("label");o.className="nav-dot",o.id=`dot-${e}`,o.onclick=o=>{s.style.left=-1*e*100+"%",makeNavDotSelected(t,e,l)},i.appendChild(o)}makeNavDotSelected(t,0,l)}function styleSliderArrows(t,e){if(1==e)return t.shadowRoot.querySelector(".left-arrow").style.visibility="hidden",void(t.shadowRoot.querySelector(".right-arrow").style.visibility="hidden");let l=t.shadowRoot.querySelector("div#slider figure");if(t.getAttribute("chevron_style")){let e=util.getCSSRule(t.shadowRoot,".left-arrow").style.cssText;util.getCSSRule(t.shadowRoot,".left-arrow").style.cssText=e+t.getAttribute("chevron_style"),e=util.getCSSRule(t.shadowRoot,".right-arrow").style.cssText,util.getCSSRule(t.shadowRoot,".right-arrow").style.cssText=e+t.getAttribute("chevron_style")}t.shadowRoot.querySelector(".left-arrow").onclick=o=>{let s=l.style.left?l.style.left.substring(0,l.style.left.length-1):0;s=0==s?-1*(e-1)*100:parseInt(s)+100,l.style.left=`${s}%`,makeNavDotSelected(t,-1*s/100,e)},t.shadowRoot.querySelector(".right-arrow").onclick=o=>{let s=l.style.left?l.style.left.substring(0,l.style.left.length-1):0;s=s-100==-1*e*100?0:s-100,l.style.left=`${s}%`,makeNavDotSelected(t,-1*s/100,e)}}function runAnimation(t,e,l){let o=t.shadowRoot.querySelector("div#slider figure");setInterval((l=>{o.style.transition||(o.style.transition=`all ${(t.getAttribute("transition")||1e3)/1e3}s ease-in-out`);let s=o.style.left?o.style.left.substring(0,o.style.left.length-1):0;s=s-100==-1*e*100?0:s-100,o.style.left=`${s}%`,makeNavDotSelected(t,-1*s/100,e)}),l)}function makeNavDotSelected(t,e,l){for(let o=0;o<l;o++){let l=t.shadowRoot.querySelector(`#dot-${o}`);o==e?l.classList.add("nav-dot-selected"):l.classList.remove("nav-dot-selected")}}function register(){monkshu_component.register("content-tile",`${APP_CONSTANTS.APP_PATH}/components/content-tile/content-tile.html`,content_tile)}const trueWebComponentMode=!0;export const content_tile={trueWebComponentMode:true,register:register,elementConnected:elementConnected,elementRendered:elementRendered};